%!TEX root = main.tex

Intuitively, $\STK$-dominating $\AMASS$ contains both launch modes and intent flags, thus can be seen as an integration of $\STK$-dominating $\LMAMASS$ and $\STK$-dominating $\IFAMASS$. 

Let us assume that $\Mm = (\act,A_0,\lmd,\aft,\Delta)$ is an $\STK$-dominating $\AMASS$. Recall that according to the definition of $\singletask$-dominating $\AMASS$, for each transition $A \xrightarrow{\startactivity(\phi)} B \in \Delta$, if $A \in \act_\singleinstance$ or $\phi \models \ntkflag$, then $B \in \act_\singletask \cup \act_\singleinstance$.

A natural idea for solving the reachability problem of $\STK$-dominating $\AMASS$ is to combine the two procedures in Section~\ref{sec:reach-lmamass}-\ref{sec:reach-ifamass} into a procedure where the {\NFA} tuples are replaced by the {\WOTrNFA} tuples.  
Nevertheless, such a procedure is problematic, since in the construction of the {\WOTrNFA} tuples for the case $\lmd(A_0) \neq \STK$ and $\lmd(A_0) \neq \SIT$, it is necessary to remove the transitions from the {\WOTrNFA} corresponding to the main task. As a result, it is hard, if not impossible, to show the termination of the procedure, since the termination arguments in Section~\ref{sect:decidability} rely on the fact that transitions in {\WOTrNFA}s are only added, but not removed. 
To resolve this problem, we propose a new idea by \emph{focusing on the evolvement of the main task (namely, the task with the main activity $A_0$ as the bottom activity), constructing a {\WOTrPDS} for the main task, and abstracting the contents of the other tasks into the control states of the {\WOTrPDS}}. By doing this, we can apply the saturation rules to compute a {\WOTrNFA} from the {\WOTrPDS} for the main task, thus avoiding removing transitions from {\WOTrNFA}s.

In the sequel, we first consider the simpler case $\lmd(A_0) = \STK$ or $\SIT$, then consider the case $\lmd(A_0) \neq \STK$ and $\lmd(A_0) \neq \SIT$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hide{
Recall that $\STK$-dominating $\AMASS$ is the combination of $\STK$-dominating $\LMAMASS$ and $\STK$-dominating $\IFAMASS$ which consider both launch modes and intent flags, hence we will combine the techniques in Section~\ref{sec:reach-lmamass} and Section~\ref{sec:reach-ifamass} to solve the configuration reachability problem of $\STK$-dominating $\AMASS$
% We have demonstrated how to simulate a single task of $\STK$-dominating $\IFAMASS$ by {\WOTrPDS}. Therefore, we solve the configuration reachability problem of $\Mm$ 
in a manner akin to addressing $\STK$-dominating $\LMAMASS$ by adapting the {NFA} tuple to the {\WOTrNFA} tuple. 


In this section, we also consider two subcases i.e. $\lmd(A_0) = \STK$ and $\lmd(A_0) \neq \STK$. The former case is similar to that in Section~\ref{sec:reach-lmamass}, but the latter case is more comlicated than that in Section~\ref{sec:reach-lmamass}. Recall that we could use {\NFA}s $\Aut_{A_0\rightsquigarrow B}$,$\Aut_{A_0\stackrel{B}\rightsquigarrow A_0'}$ and $\Aut_{A_0\stackrel{B}\rightsquigarrow B}$ to represent the different case of $A_0$-task. From the construction, we have $\Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow B}) = B\act^*A_0'B\act^*\cap\Lang((\Aut_{A_0 \stackrel{B}\rightsquigarrow A_0'})^{\post^*}_{\Pp_{A_0}}(p_1))$. Moreover, we have a proposition that, for each $BwA_0'Bw'\in\Lang((\Aut_{A_0 \stackrel{B}\rightsquigarrow B}))$, then $A_0'Bw'\in\Lang((\Aut_{A_0 \stackrel{B}\rightsquigarrow A_0'}))$. Therefore when we use $\Aut_{A_0\stackrel{B}\rightsquigarrow B}$ to represent the $A_0$-task, once $A_0'$ is started, then we could use $\Aut_{A_0 \stackrel{B}\rightsquigarrow A_0'}$ to represent the $A_0$-task to simulate the behavior of clearing the activities above $A_0'$ in the $A_0$-task. However, if we adapt {\NFA} to {\WOTrNFA}, the proposition does not hold, since the transductions may change the content under $A_0'$. We will use the following example to illustrate why the proposition does not hold.
\begin{example}
    Let $\Mm = (\act, A_0, \lmd, \aft, \Delta)$ be an $\STK$-dominating $\AMASS$,
where $\act = \{A_0, B, A_0', A_1'\}$, the functions $\lmd$ and $\aft$ are defined in Table~\ref{tab-attribute-nostk}. Moreover, $\Delta = \{\tau_1,\tau_2,\tau_3,\tau_4,\back\}$, where 
$\tau_1 = A_0\xrightarrow{\startactivity(\rtfflag)}B$, 
$\tau_2 = B\xrightarrow{\startactivity(\bot)}A_1'$, 
% $\tau_3 = A_1'\xrightarrow{\startactivity(\bot)}A_2'$, 
$\tau_3 = A_1'\xrightarrow{\startactivity(\bot)}A_0'$. 
$\tau_4 = A_0'\xrightarrow{\startactivity(\rtfflag)}A_0$. 

From the construction of $\Aut_{A_0\rightsquigarrow B}$, $\Aut_{A_0\stackrel{B}\rightsquigarrow A_0'}$ and $\Aut_{A_0\stackrel{B}\rightsquigarrow B}$ we know that 
\begin{itemize}
    \item $\Lang(\Aut_{A_0\rightsquigarrow B}) = \{BA_0\}$, 
    \item $\Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow A_0'}) = \{A_0'BA_0\}$, 
    \item $\Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow B}) = \{BA_0 A_0'\}$, 

    % \item $\Lang(\Aut_{A_0\rightsquigarrow C}) = \{CA_0\}$, $\Lang(\Aut_{A_0\rightsquigarrow B}) = \{BA_0\}$,
    % \item $\Lang(\Aut_{A_0\stackrel{C}\rightsquigarrow A_0'}) = \{A_0'CA_0\}$, $\Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow A_0'}) = \{A_0'BA_0\}$, 
    % \item $\Lang(\Aut_{A_0\stackrel{C}\rightsquigarrow A_0}) = \{A_0 A_0'C\}$, $\Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow A_0}) = \{A_0 A_0'B\}$,
    % \item $\Lang(\Aut_{A_0\stackrel{C}\rightsquigarrow C}) = \{CA_0 A_0'C\}$, $\Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow C}) = \{CA_0 A_0'B\}$,
    % \item $\Lang(\Aut_{A_0\stackrel{C}\rightsquigarrow B}) = \{BA_0 A_0'C\}$, $\Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow B}) = \{BA_0 A_0'B\}$,
\end{itemize}
Then we have $BA_0 A_0' \in \Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow B})$ and $A_0' \notin \Lang(\Aut_{A_0\stackrel{B}\rightsquigarrow A_0'})$. Therefore the proposition does not hold.

Moreover, the intent flag $\rtfflag$ makes the relationship between $A_0$-task and the non-$A_0$-tasks closer. Let's assume $\Mm' = (\act, A_0,\lmd,\aft,\Delta')$ where $\Delta' = \{\tau_1',\tau_2,\tau_3,\tau_4',\back\}$ such that $\tau_1' = A_0\xrightarrow{\startactivity(\bot)}B$, $\tau_4' = A_0'\xrightarrow{\startactivity(\bot)}A_0$.

Let's consider two configurations $(([A_0'BA_0],0),([A_1'],1))$ and $(([A_0'BA_0],0))$. It is easy to observe that both $(([A_0'BA_0],0),([A_1'],1))$ and $(([A_0'BA_0],0))$ are reachable from the initial configuration $(([A_0],0))$ in $\Mm'$ as the following transitions :
$$(([A_0],0)) \xrightarrow[]{\tau_1'}(([BA_0],0)) \xrightarrow[]{\tau_2}(([A_1'],1),([BA_0],0))\xrightarrow[]{\tau_3}(([A_0'BA_0],0),([A_1'],1))$$
$$\xrightarrow[]{\tau_4'}(([A_0A_0'BA_0],0),([A_1'],1)) \xrightarrow[]{\tau_1'}(([BA_0A_0'BA_0],0),([A_1'],1))\xrightarrow[]{\tau_2}(([A_1'],1),([BA_0A_0'BA_0],0))$$
$$ \xrightarrow[]{\back}(([BA_0A_0'BA_0],0))\xrightarrow[]{\back}(([A_0A_0'BA_0],0))\xrightarrow[]{\back}(([A_0'BA_0],0)).$$

Moreover, $(([A_0'BA_0],0),([A_1'],1))$ is reachable from the initial configuration $(([A_0],0))$ in $\Mm$, but $(([A_0'BA_0],0))$ is not reachable from the initial configuration $(([A_0],0))$ in $\Mm$. Since the content of $A_0$-task could not be $BA_0A_0'BA_0$ due to the intent flag $\rtfflag$, we could observe it from the following transitions:
$$(([A_0'BA_0],0),([A_1'],1))\xrightarrow[]{\tau_4}(([A_0A_0'B],0),([A_1'],1))\xrightarrow[]{\tau_1}(([BA_0A_0'],0),([A_1'],1)).$$
\begin{table}[htbp]
	\begin{center}
	\begin{tabular}{|c|c|c|c|c|c|}
	\hline
	Activity & $\lmd$ & $\aft$\\
	\hline
	$A_0$ & $\STD$ & 0\\
	\hline
	$B$ & $\STD$ & 0 \\
	\hline
	$C$ & $\STD$ & 0 \\
	\hline
	$A_0'$ & $\STK$ & 0 \\
	\hline
	$A_1'$ & $\STK$ & 1 \\
	\hline
	$A_2'$ & $\STK$ & 2 \\
	\hline
	$A_3'$ & $\STK$ & 3 \\
	\hline
	\end{tabular}
	\caption{Attributes of activities}
	\label{tab-attribute-nostk}
	\end{center}
\end{table}
\end{example}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% the difficulty is to simulate $\tau_7 = A_2\xrightarrow{\startactivity(\bot)} A_0'$. To tackle this, we could apply the transition rule $(p_1, B, \epsilon, \tau_{\id}, p_{\pop})$ to modify the {\WOTrNFA} $\Aut$ of $A_0$-task, which is corresponding to $B\xrightarrow{\startactivity(\bot)}A_0'$. 
% Although it could help us to recognize $\rho_7$, but it is hard to prove that the procedure will terminate. Since each time we start an $\STK$-activity which is not $A_0'$ from some activity $A$ in the $A_0$-task, we need to delete some transitions in $\Aut$ to maintain the top activity is $A$, and once we start $A_0'$ to escalate the $A_0$-task to be the top, we need to add somes transitions in $\Aut$ to simulate the behavior of pushing $A_0'$ or poping until $A_0'$. Consequently, it is hard to prove the modification of $\Aut$ will terminate.
% This problem could be solved by applying $(p_1, B, \epsilon, \tau_{\id}, p_{\pop})$ in the {\WOTrNFA} $\Aut$ of $A_0$-task to simulate the behavior of executing $\tau_7$. 
% We consider $\rho_4\xrightarrow[\Mm]{\tau_5}\rho_5\xrightarrow[\Mm]{\tau_6}\rho_6\xrightarrow[\Mm]{\tau_7}\rho_7$,
% and assume that there is a {\WOTrNFA}s tuple $(\Aut, \Aut_{A_1})$ to recognize the configuration $\rho_4 = (([A_0'CB A_0],0),([A_1],1))$.
% \begin{itemize}
%     \item From $\tau_5$, we have $(\Aut',\Aut_{A_1})$ to recognize $\rho_5$, where $\Aut'$ is obtained from $\Aut$ by computing the $\post^*$. Therefore we have $A_0'CB A_0 \in \Lang(\Aut')$ and $BA_0'C\dag A_0 \in \Lang(\Aut')$. 
%     \item From $\tau_6$, we have $()$
% \end{itemize}
% From the example, we notice that 
% However, if we do not delete the transitions from $\Aut$, it may recognize some unreachable configurations from the initial configuration. Since the content of $A_0$-task is relevant to the non-$A_0$-tasks. 


\subsection{The case $\lmd(A_0) = \STK$ or $\SIT$}\label{sec:amass-stk}

In this case, we compute a finite set of {\WOTrNFA} tuples to represent the set of reachable configurations.
For this purpose, for each $A \in \act_\singletask \cup \singleinstance$, we define a {\WOTrPDS} $\Pp_A$ to simulate the behaviors of an $A$-task. 

If $\lmd(A) = \SIT$, then we define a {\WOTrPDS} $\Pp_A  = (P_A, \Gamma_A, \TranSet_A, \Delta_A)$, where $P_A = \{p_0\}$, $\Gamma_A = \{A\}$, $\TranSet_A = \{\tau_{\id}\}$, and $\Delta_A = \{(p_0, A, \epsilon, p_0)\}$. Note that $\Pp_A$ is actually a {\PDS}. 

In the sequel, let us assume that $\lmd(A) = \STK$. 

In $\Pp_A$, the transitions of $\Mm$ that keep the $A$-task as the top task will be used. According to the definition of $\singletask$-dominating $\AMASS$, for a transition $B \xrightarrow{\startactivity(\phi)} C$, if $B \in \act_\singleinstance$ or $\phi \models \ntkflag$, then $C \in \act_\singletask \cup \act_\singleinstance$. Therefore, we distinguish between the following situations for the transitions $B \xrightarrow{\startactivity(\phi)} C$ of $\Mm$ that keep the $A$-task as the top task. 
\begin{itemize}
\item $B \in \act_\standard \cup \act_\singletop \cup \{A\}$, $C \in \act_\standard \cup \act_\singletop$, and $\phi \models \neg \ntkflag$,
%
\item $B \in \act_\standard \cup \act_\singletop$ and $C = A$. (Note that according the semantics of $\AMASS$, in this case, no matter what $\phi$ is, all the activities on the top of $A$ will be removed, since $\lmd(A) = \singletask$. In particular, $A$ will not be moved to the top of the stack, even if $\phi \models \rtfflag$.)
\end{itemize}
Here we ignore the transitions $A \xrightarrow{\startactivity(\phi)} A$, since it does not change the content of the stack. 

We are ready to present the construction of $\Pp_A$. Let $\Pp_A = (P_A, \Gamma_A, \TranSet_A, \Delta_A)$, where 
\begin{itemize}
\item $P_{A} = \{p_0\}\cup\{ p_{B}\mid B \in  \act_\standard \cup \act_\singletop \cup \{A\}\}$,
\item $\Gamma_{A} = \act_\standard \cup \act_\singletop \cup \{A, \dag\}$, 
\item $\TranSet_A = \{\tau_{\id} \}\cup \{\tau_{B, \dag} \mid B \in \act_\standard \cup \act_\singletop \} \cup \{\tau_{B} \mid B \in \act_\standard \cup \act_\singletop\}  \cup \{\tau_{\not B} \mid B \in \act_\standard \cup \act_\singletop\}$, 
%where $\tau_B$ (resp. $\tau_{\not B}$) is the transduction that checks that $B$ occurs (resp. does not occur) in the input string but keeps the input string unchanged, and 
\item $\Delta_{A}$ is defined as follows:
        \begin{itemize}
            \item for each $B \in \Gamma_{A} \setminus \{\dag\}$, $(p_0, B, \varepsilon, \tau_{\id}, p_0) \in \Delta_{A}$, (Recall that $\back$ can be applied anytime in $\Mm$.)
	    %
	    \item moreover, we consider the transitions $B \xrightarrow{\startactivity(\phi)} C$ of $\Mm$ that keep the $A$-task as the top task, to construct $\Delta_A$, 
	    %therefore, we distinguish the following two cases: either $B \in \act_\standard \cup \act_\singletop \cup \{A\}$ and $C \in \act_\standard \cup \act_\singletop$, or $B \in \act_\standard \cup \act_\singletop$, $\phi \models \ntkflag$, and $C = A$, 
	    %
	    %	    	
		%	\item for each transition $B \xrightarrow{\startactivity(\phi)} C$ such that if $B \neq A$ and $\phi \models \ntkflag$, then $C = A$, 
			\begin{itemize}
				\item if $B \in \act_\standard \cup \act_\singletop \cup \{A\}$, $C \in \act_\standard \cup \act_\singletop$, and $\phi \models \neg \ntkflag$, then 
				%
				\begin{itemize}
				\item if $\phi \models \ctpflag$ and $B \neq C$, we have 
				\begin{itemize}
					\item $(p_0, C, CB, \tau_{\not C}, p_0) \in \Delta_{A}$, 
					\item $(p_0, B, \varepsilon, \tau_{C}, p_C) \in \Delta_{A}$, $(p_C, C, C, \tau_{\id}, p_0)  \in \Delta_{A}$, and for each $\gamma \in \Gamma_A \setminus \{C\}$, $(p_C, \gamma, \varepsilon, \tau_{\id}, p_C) \in \Delta_{A}$, 
				\end{itemize}
%
				\item if $\phi \models \rtfflag \wedge \neg\ctpflag$ and $B\neq C$,  
                we have $(p_0, B, CB, \tau_{\not C}, p_0) \in \Delta_{A}$ 
                and $(p_0, B, CB, \tau_{C, \dag}, p_0) \in \Delta_{A}$,
%
				\item if either $\phi \models \neg\ctpflag \wedge \neg \rtfflag \wedge \stpflag$ or $\phi \models \neg\ctpflag \wedge \neg \rtfflag$ and $\lmd(C) = \singletop$, moreover, $B \neq C$, we have $(p_0, C, CB, \tau_{\id}, p_0) \in \Delta_{A}$, 
				%
				\item if $\phi \models \neg\ctpflag \wedge \neg \rtfflag \wedge \neg \stpflag$ and $\lmd(C) = \standard$, then $(p_0, C, CB, \tau_{\id}, p_0) \in \Delta_{A}$,
				\end{itemize}
				
				\item if $B \in \act_\standard \cup \act_\singletop$ and $C = A$,  then we have $(p_0, B, \varepsilon, \tau_{\id}, p_A) \in \Delta_{A}$, $(p_A, A, A, \tau_{\id}, p_0)  \in \Delta_{A}$, and for each $\gamma \in \Gamma_A \setminus \{A\}$, $(p_A, \gamma, \varepsilon, \tau_{\id}, p_A) \in \Delta_{A}$. 
				%
            %
            \end{itemize}
        \end{itemize}
\end{itemize}
From the construction of $\Pp_A$, we know that in every configuration that are reachable from the configuration $(p_0, A)$, there is exactly one occurrence of $A$ in the stack, moreover,  $A$ is always kept as the bottom symbol of the stack. 
The fact that $\Pp_{A}$ is a {\WOTrPDS} can be shown similarly to the fact that $\Pp_\Mm$ is a {\WOTrPDS} in Section~\ref{sec:reach-ifamass}.
Moreover, for $A \in \act_\singleinstance$, we define $\Pp_A = (P_A, \Gamma_A, \TranSet_A, \Delta_A)$, where $P_A = \{p_0\}$, $\Gamma_A = \{A\}$, $\TranSet_A = \{\tau_{\id}\}$, and $\Delta_A = \{(p_0, A, A, p_0), (p_0, A, \varepsilon, p_0)\}$. Note that $\Pp_A$ can be seen as a {\PDS} since $\TranSet_A = \{\tau_{\id}\}$.
%For a $\Pp_A$-{\WOTrNFA} $\Aut$, let us use $\Lang(\Aut)$ to denote $w \in \act^+$ such that there is $w' \in (\Gamma_A)^+$ satisfying that $w' \in \Lang(\Aut)$ and $prj_{\act}(w') = w$. 


%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hide{
Let $A\in\act_\STK$. We define a {\WOTrPDS} $\Pp_{A} = (P, \Gamma_{A}, \TranSet_{A},\Delta_{A} )$, where
% to simulate the behaviors of the $A'$-task of $\Mm$ for each $A'\in\act_{\STK}$, where
\begin{itemize}
\item $P = \{p_0, p_{\pop}, p_{\ctkflag}\}\cup\{p_{A'}\mid A'\in\Gamma_A\}$,
% \item $\Gamma_{A} = \act_\STD\cup\act_\STP \cup \{A,\dag,\triangleleft\}$, 
\item $\Gamma_{A} = \act_\STD\cup\act_\STP \cup \{A,\dag\}$, 
\item $\TranSet_{A} = \{\tau_{\id} \}\cup \{\tau_{A', \dag} \mid A' \in \Gamma_A\} \cup \{\tau_{A'} \mid A' \in \Gamma_A\}  \cup \{\tau_{\not A'} \mid A' \in \Gamma_A\}$,
%  where $\tau_A$ is the transduction that checks that $A$ occurs in the input string but keeps the input string unchanged, and 
\item $\Delta_{A}$ is defined as follows:
        \begin{itemize}
            \item For each $A' \in \Gamma_A$, then $(p_0, A', \varepsilon, \tau_{\id}, p_0) \in \Delta_{A}$.
            % (Recall that $\POP$ can be applied anytime in $\Mm$.)
			\item For each transition $A'\xrightarrow{\startactivity(\phi)}A''\in\Delta$ such that $\lmd(A')\neq \SIT$ and $\lmd(A'')\neq \SIT$,
			\begin{itemize}
                \item if either $\lmd(A'') = \STD$ and $\phi = \bot$ or $\lmd(A'') = \STD$ and $\phi\models\stpflag\wedge\neg\rtfflag\wedge\neg\ctpflag$ and $A'\neq A''$ or $\lmd(A'') = \STP$ and $\phi\models\neg\rtfflag\wedge\neg\ctpflag$ and $A'\neq A''$,
                then $(p_0, A', A''A', \tau_{\id}, p_0) \in \Delta_{A}$, 
				% \item if $\phi\models\stpflag\vee\lmd(B) = \STP$ and $A\neq B$, or $\phi=\bot$, we have $(p_1, A, BA, \tau_{\id}, p_1) \in \Delta_{A'}$, 
				% \item if $\phi\models\stpflag$ and $A\neq B$, or $\phi=\bot$, 
                % we have $(p_1, A, BA, \tau_{\id}, p_1) \in \Delta_{A'}$, 
				\item if $\lmd(A'') = \STD$ or $\STP$, $\phi\models\ctpflag$ an $A'\neq A''$, then 
				\begin{itemize}
					\item $(p_0, A', A''A', \tau_{\not A'}, p_0) \in \Delta_{A}$, 
					\item $(p_0, A', \varepsilon, \tau_{A'}, p_{A'}) \in \Delta_{A}$, and for each $B \in \Gamma_A\setminus\{A'\}$, $(p_{A'}, B, \varepsilon, \tau_{\id}, p_{A'}) \in \Delta_{A}$, moreover, $(p_{A'}, A'', A'', \tau_{id}, p_0)  \in \Delta_{A}$, 
				\end{itemize}
				\item if $\lmd(A'') = \STD$ or $\STP$, $\phi\models\rtfflag\wedge\neg\ctpflag$ and $A'\neq A''$,
                then $(p_0, A', A''A', \tau_{\not A'}, p_0) \in \Delta_{A}$ 
                and $(p_0, A', A''A', \tau_{A', \dag}, p_0) \in \Delta_{A}$.
                \item if $\lmd(A) = \STK$, $A'' = A$, 
                % then $(p_0, A',\epsilon,\tau_{\id},p_{\pop})\in\Delta_{A}$, and for each $B\in\Gamma_A\setminus\{A\}$, $(p_{\pop},B,\epsilon,\tau_{\id},p_{\pop})\in\Delta_{A}$, moreover, $(p_{\pop},A,A,\tau_{\id},p_0)\in\Delta_{A}$.
			\begin{itemize}
				\item if $\phi\models\ctkflag$, then $(p_0, A', \epsilon, \tau_{\id}, p_{\ctkflag}) \in \Delta_{A}$, and for each $B\in\Gamma_A\setminus\{\triangleleft\}$, $(p_{\ctkflag},B,\epsilon,\tau_{\id}, p_{\ctkflag})\in\Delta_{A}$, moreover, $(p_{\ctkflag},\triangleleft,A\triangleleft,\tau_{\id},p_0)\in\Delta_{A}$, 
				\item if $\phi\models\neg\ctkflag$ and $A'\neq A$ then 
                $(p_0, A',\epsilon,\tau_{\id},p_{\pop})\in\Delta_{A}$, and for each $B\in\Gamma_A\setminus\{A,\triangleleft\}$, $(p_{\pop},B,\epsilon,\tau_{\id},p_{\pop})\in\Delta_{A}$, moreover, $(p_{\pop},A,A,\tau_{\id},p_0)\in\Delta_{A}$.
			\end{itemize}
			\end{itemize}
            %
        \end{itemize}
Note that in the definition of $\Delta_{A}$, the transition rules $A' \xrightarrow{\startactivity(\bot)} A'' \in \Delta$ satisfying the following condition are ignored: $\lmd(A') = \singleinstance$, or $\lmd(A'') = \singleinstance$, or $\lmd(A'') = \singletask$ and $A'' \neq A$. 
Moreover, if $\lmd(A) = \singleinstance$, according to the definition of $\STK$-dominating $\AMASS$ and $\Qq_A$, we know that $\Delta_A = \{(p_0,A,\epsilon,\tau_\id, p_0)\}$.
\end{itemize}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%


Recall that the configuration reachability problem of an $\AMASS$ $\Mm$ is to decide for a given tuple $(\aname_1 \cdots \aname_k, (\Aut_1,\cdots, \Aut_k))$ where $\Aut_i$ is an {\NFA} for each $i \in [k]$, whether $\confs((\aname_1 \cdots \aname_k, (\Aut_1,\cdots, \Aut_k))) \cap \RConfs(\Mm) \neq \emptyset$. 
%
We shall use the tuples $(\aname'_1 \cdots \aname'_l, (\AutB_{1},\cdots,\AutB_{l}))$ to represent the configurations from $\RConfs(\Mm)$, where for each $i \in [l]$, $\Aut_i$ is a $\Pp_{A_i}$-{\WOTrNFA} for some $A_i \in \act_\singletask \cup \act_\singleinstance$ satisfying $\aft(A_i) = \aname_i$.  Note that the alphabet of $\AutB_{j}$ for each $j \in [l]$, that is, $\Gamma_{A_j}$, contains the dummy symbol $\dag$,  while the alphabet of $\Aut_i$  for each $i \in [k]$ is $\act$. If $\RConfs(\Mm)$ can be represented by a finite set of tuples, then the configuration reachability problem is reduced to checking whether there exists a tuple $(\aname_1 \cdots \aname_k, (\AutB_{1},\cdots,\AutB_{k}))$ such that $\Lang(\AutB_i) \cap \Lang(\Aut'_i) \neq \emptyset$ for each $i \in [k]$, where $\Aut'_i$ is obtained from $\Aut_i$ by adding $(q, \dag, q)$ for each state $q$ in it. 

As a result, it is sufficient to show that $\RConfs(\Mm)$ enjoys a {\WOTrNFA}-representation, that is, $\RConfs(\Mm)$ can be represented by a finite set of tuples $(\aname'_1 \cdots \aname'_l, (\AutB_{1},\cdots,\AutB_{l}))$. 

\begin{definition}[{\WOTrNFA}-representation]
    For each $\theta = \aname'_1 \cdots \aname'_l \in \Theta_\Mm$, a {\WOTrNFA}-representation of $\RConfs(\Mm, \theta)$ is $(\AutB_{i, 1},\cdots,\AutB_{i, l})_{i \in [n]}$ such that for every $i \in [n]$ and $j \in [l]$,  $\AutB_{i, j}$ is a $\Pp_{A_j}$-{\WOTrNFA} (where $\aft(A_j) = \aname'_j$), and 
    $$\RConfs(\Mm, \theta) =\{(\aname'_1 \cdots \aname'_{l}, (w_1, \cdots, w_{l})) \mid  i \in [n], \forall j \in [l].\ w_j \in \Lang(\AutB_{i, j})|_{\act}\}.$$
    % where $\Lang_{\mhcancel{\dag,\triangleleft}}(\AutB_{i,j}) = \{w_1\cdots w_n\mid \dag^*w_1\cdots\dag^*w_n\dag^*\triangleleft\in\Lang(\AutB_{i,j})\}$.
\end{definition}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hide{
Let us assume that $\Mm = (\act,A_0,\lmd,\aft,\Delta)$ is an $\STK$-dominating $\AMASS$.

\hide{
Furthermore, to solve the configuration reachability problem of $\Mm$, we slightly adapt the defining of configuration and define the dummy configuration $\rho = ((S_1,\aname_1),\cdots,(S_n,\aname_n))$, where $(S_i,\aname_i)$ is a dummy task, where for each $i\in[n]$, $S_i\in\dag^*(\act\dag^*)^+\triangleleft$ denotes the content of the stack and $\aname_i$ is the task affinity of the task.
Let $\confs_{\mhcancel{\dag,\triangleleft}}$ denotes the set of dummy configurations of $\Mm$.
% A task of $\Mm$ is encoded as a pair $(S,\aname)$, where $S = [A_1,\cdots,A_n] \in\dag^*(\act\dag^*)^+\triangleleft$ denotes the content of the stack, $\triangleleft$ is a special symbol to denote the bottom of the stack, $\aname$ is the task affinity of the task. A configuration of $\Mm$ is $\rho = ((S_1,\aname_1), \cdots, (S_n,\aname_n))$.

We shall define the transition relation $\rho \xhookrightarrow[\Mm]{\tau}\rho'$ where $\tau\in\Delta$ is a transition rule, $\rho\in\confs_{\mhcancel{\dag,\triangleleft}}$ and $\rho'\in\confs_{\mhcancel{\dag,\triangleleft}}$ is obtained by applying $\tau$ on $\rho$. Let $\xhookrightarrow[\Mm]{}^*$ denote the reflexive and transitive closure of $\xhookrightarrow[\Mm]{}$.

Then for a configuration $\rho = ((S_1,\aname_1),\cdots,(S_n,\aname_n))$ where for each $i\in[n]$, $S_i = [A_{i,1},\cdots,A_{i,k_i}]$, then
\begin{itemize}
    \item if $(([A_0],\aft(A_0)))\xRightarrow[\Mm]{}\rho$ then $(([A_0],\aft(A_0)))\xhookrightarrow[\Mm]{}^* ((S_1',\aname_1),\cdots,(S_n',\aname_n))$ where for each $i\in[n]$, $S_i' = [A_{i,1},\dag^{j_{i,1}},A_{i,k_i},\dag^{j_{i,k_i}},\triangleleft]$, for some $j_{i,1},\cdots,j_{i,k_i}\in \Nn$.
\end{itemize}
}

% and a dummy configuration $\rho' = ((S_1',\aname_1),\cdots,(S_n',\aname_n))$, \\
% \begin{center}
% $(([A_0],\aft(A_0)))\xRightarrow[\Mm]{}\rho$ iff $(([A_0],\aft(A_0)))\xhookrightarrow[\Mm]{}^*\rho'$
% \end{center}


Let $(\AutB_1,\cdots,\AutB_k)$ be an {\WOTrNFA} tuple over the alphabet $\act\cup\{\dag,\triangleleft\}$, and $\theta = \aname_1\cdots\aname_k$ be an affinity sequence. Our goal is to decide whether there is a configuration $\rho$ that is reachable from the initial configuration and accepted by $(\theta, (\AutB_1,\cdots,\AutB_k))$.

The main idea is to show that the set of configurations that are reachable from the initial configuration can be represented finitely as {\WOTrNFA}-representations defined in the sequel. 
% Our approach to tackle this case is to simulate the behaviors of a single task by a {\WOTrPDS}, and use a set of {\WOTrNFA} tuples to represent the configurations of {\AMASS} $\Mm$. Similarly, we define the \emph{\WOTrNFA-representation} as follows:

Let $\AutB$ be an {\WOTrNFA} over the alphabet $\act\cup\{\dag, \triangleleft\}$, we define 
$$\Lang_{\mhcancel{\dag, \triangleleft}}(\AutB) = \{w_1\cdots w_n\mid \dag^*w_1\cdots\dag^*w_n\dag^*\triangleleft\in\Lang(\AutB)\}.$$
Then let $(\AutB_1,\cdots,\AutB_k)$ be an {\WOTrNFA} tuple over the alphabet $\act\cup\{\dag, \triangleleft\}$, 
and $\theta = \aname_1\cdots\aname_k$ be an affinity sequence. Then we define $\confs_{\mhcancel{\dag,\triangleleft}}((\theta, (\AutB_1,\cdots,\AutB_k)))$, \emph{the set of configurations accepted by $(\theta, (\AutB_1,\cdots,\AutB_k))$}, is defined as as the set of configurations $\rho = ((S_1,\aname'_1),\cdots,(S_k,\aname'_k))$  such that $(S_1, \cdots, S_k) \in \Lang_{\mhcancel{\dag,\triangleleft}}(\AutB_1)\times\cdots\times\Lang_{\mhcancel{\dag,\triangleleft}}(\AutB_k)$, and for each $i \in [k]$, $\aname_i=\aname_i'$.

\begin{definition}[{\WOTrNFA}-representation]
    Given a $k$-ary string relation $R\subseteq\act^k = \bigcup \limits_{i =1 }^n L_{i,1} \times \cdots \times L_{i, k}$, a {\WOTrNFA}-representation of $R$ is $\{(\AutB_{i,1},\cdots,\AutB_{i,k})\}_{i\in[n]}$, where $\AutB_{i,j}$ is a {\WOTrNFA} defining $L_{i,j}$, that is, $\Lang_{\mhcancel{\dag,\triangleleft}}(\AutB_{i,j}) = L_{i,j}$.
    % where $\Lang_{\mhcancel{\dag,\triangleleft}}(\AutB_{i,j}) = \{w_1\cdots w_n\mid \dag^*w_1\cdots\dag^*w_n\dag^*\triangleleft\in\Lang(\AutB_{i,j})\}$.
\end{definition}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    
    
    \begin{lemma}\label{lem:amass-recog}
        For each $\theta \in \Theta_\Mm$, a {\WOTrNFA}-representation of $\RConfs(\Mm, \theta)$ can be effectively computed.
    \end{lemma} 
    % We solve the reachability problem in this case by deciding whether there is a {\WOTrNFA}-representation $(\theta,(\Aut_1,\cdots,\Aut_k))$ of $\conf_{\theta}$ for $\theta\in\Theta_{\Mm}$, satisfying $\Aut_i\cap\Aut_i\neq\emptyset$ for each $i\in[k]$ with $\Lang(\Aut_i) = \Lang_i$.

    
%    According to Lemma~\ref{lem:amass-recog}, for each $\theta = \aname_1 \cdots \aname_k \in \Theta_\Mm$, an {\WOTrNFA}-representation of $\RLang(\Mm, \theta)$, say $(\AutB_{\theta, i,1},\cdots,\AutB_{\theta, i,k})_{i \in [n_\theta]}$, can be effectively computed. 
%    Then the configuration reachability problem of $\Mm$ is solved as follows: If there is $\theta =  \aname_1 \cdots \aname_k \in \Theta_\Mm$ such that $\Lang(\AutB_{\theta, i, j}) \cap \Lang(\Aut_j') \neq \emptyset$ where let $\Aut_j = (Q,\act,\delta,I,F)$, $\Aut_j'$ is obtained from $\Aut_j$ by adding the transitions $(q,\dag,q)$ for every $q\in Q$, then adding the transitions $(q,\triangleleft,q_f)$ for every $q\in F$ where $q_f\notin Q$, finally setting $F$ as $\{q_f\}$ and $Q$ as $Q\cup\{q_f\}$ for each $j \in [k]$, then report ``yes'', otherwise, report ``no''.
    % Then the configuration reachability problem of $\Mm$ is solved as follows: If there is $\theta =  \aname_1 \cdots \aname_k \in \Theta_\Mm$ such that $\Lang(\AutB_{\theta, i, j}) \cap \Lang(\Aut_j') \neq \emptyset$ where let $\Aut_j = (Q,\act,\delta,I,F)$, $\Aut_j'$ is obtained from $\Aut_j$ by adding the transitions $(q,\dag,q)$ for every $q\in Q$, then adding the transitions $(q,\triangleleft,q_f)$ for every $q\in F$, finally replacing $F$ with $\{q_f\}$ for each $j \in [k]$,  then report ``yes'', otherwise, report ``no''.
    
We prove Lemma~\ref{lem:amass-recog} by showing that $\RConfs(\Mm, \theta)$ for each $\theta \in \Theta_\Mm$ can be \emph{saturated by repeatedly applying a finite set of rules}. 

Before presenting the rules, let us introduce several notations. 

In the sequel, we define the $\Pp_{A}$-{\WOTrNFA}s $\AutB_{A}$ and $\AutB_{A\rightsquigarrow B}$ for $B \in \Gamma_A$ such that $\Lang(\AutB_A) = \{A\}$ and $\Lang(\AutB_{A\rightsquigarrow B}) =B\act^* \cap \Lang((\AutB_{A})^{\post^*}_{\Pp_A})$. 
\begin{itemize}
    \item $\AutB_{A} = (P', \Gamma_A, \{(p_0, A,\tau_\id, p_f)\},\{p_0\},\{p_f\} )$, where $P' = P \cup \{p_f\} \cup \{\langle p_0,A'\rangle \mid A'\in\Gamma_A\}$ with $p_f \not \in P$.  
    %
    \item For $B \in \Gamma_A$, $\AutB_{A\rightsquigarrow B}$ is obtained from $(\AutB_{A})^{\post^*}_{\Pp_A}$ by removing all non-$B$ transitions out of $p_0$, then removing all transitions that cannot be reached from $p_0$. 
\end{itemize}
Note that it is possible that $\Lang(\AutB_{A\rightsquigarrow B}) = \emptyset$.
From the definitions, it is easy to see that $\Lang((\AutB_A)^{\post^*}_{\Pp_A}) = \bigcup\limits_{B\in\Gamma_A} \Lang(\AutB_{A\rightsquigarrow B})$. Moreover, from the definition of $\Pp_A$, since there is exactly one occurrence of $A$ in the stack and $A$ is always the bottom symbol of the stack, we have $\Lang(\AutB_{A\rightsquigarrow A}) = \Lang(\AutB_A)$. 

We are ready to present the procedure that computes effectively $\AutReach$, a finite set of pairs $(\aname'_1 \cdots \aname'_l, (\AutB_1, \cdots, \AutB_l))$ where each of $\AutB_i$'s is of the form $\AutB_{A\rightsquigarrow B}$ for $A \in \act_\singletask\cup\act_\singleinstance$ and $B \in \Gamma_A$, by repeatedly applying a finite set of saturation rules, such that
for each $\theta = \aname'_1 \cdots \aname'_{l} \in \Theta_\Mm$, 
$$\RConfs(\Mm, \theta) =\bigcup \limits_{(\theta, (\AutB_1, \cdots, \AutB_l)) \in \AutReach} \left\{(\theta, (w_1, \cdots, w_{l})) \mid \forall j \in [l].\ w_j \in \Lang(\AutB_{j})|_{\act} \right\}.$$

%\[\RConfs(\Mm) = \bigcup \limits_{(\aname_1 \cdots \aname_k, (\AutB_1, \cdots, \AutB_k)) \in \AutReach} \confs_{\mhcancel{\dag,\triangleleft}}((\aname_1 \cdots \aname_k, (\AutB_1, \cdots, \AutB_k))).\]

Initially, let $\AutReach := \{(\aft(A_0),(\Aut_{A_0}))\}$.
Then it adds pairs to $\AutReach$, according to the following saturation rules, until no more pairs can be added. 

\smallskip
\fbox
{
\begin{minipage}{0.9\textwidth}
\begin{enumerate}
    %
    \item If $A \xrightarrow{\startactivity(\phi)}A' \in\Delta$, $\lmd(A')=\STK$ or $\singleinstance$, $(\aname'_1 \cdots \aname'_l, (\AutB_1,\cdots,\AutB_l)) \in \AutReach$ such that $\Lang(\AutB_1) \neq \emptyset$ and $\AutB_1 = \AutB_{B\rightsquigarrow A}$ for some $B \in \act_\singletask\cup\act_\singleinstance$, moreover, $\namefun_{A'}(\aname'_1 \cdots \aname'_l) = \bot$,
    then let $\AutReach: = \AutReach \cup \{(\aft(A')\aname'_1 \cdots \aname'_l, (\AutB_{A'},\AutB_1,\cdots,\AutB_k))\}$.
    % where $\AutB_1'$ is obtained from $\AutB_1$ by 
    % removing all non-$A$ transitions out of $p_0$, then removing all transitions cannot be reached from $p_0$.
        \textbf{[launch an $A'$-task]}

    \item If $A \xrightarrow{\startactivity(\phi)}A' \in\Delta$, $\lmd(A')=\STK$ or $\singleinstance$, $(\aname'_1 \cdots \aname'_l, (\AutB_1,\cdots,\AutB_l)) \in \AutReach$ such that $\Lang(\AutB_1) \neq \emptyset$ and $\AutB_1 = \AutB_{B\rightsquigarrow A}$ for some $B \in \act_\singletask\cup\act_\singleinstance$, moreover, $\namefun_{A'}(\theta) = i$ for some $i \in [l]$ with $i > 1$, 
        then let $\AutReach:= \AutReach \cup \{(\theta', (\AutB_{A'}, \AutB_1, \cdots,\AutB_{i-1},\AutB_{i+1},\cdots,\AutB_{l}))\}$, where $\theta' = \aname'_i\aname'_1\dots\aname'_{i-1}\aname'_{i+1}\dots\aname'_l$. 
        % and $\AutB_1'$ is obtained from $\AutB_1$ by removing all non-$A$ transitions out of $p_0$, then removing all transitions cannot be reached from $p_0$.
        \textbf{[escalate the $A'$-task to be the top and reset its content to $[A']$]}
        %
    \item If $(\aname'_1 \cdots \aname'_l, (\AutB_1,\cdots,\AutB_l)) \in \AutReach$ and $l>1$, then let $\AutReach := \AutReach \cup \{(\aname'_2\dots\aname'_l, (\AutB_2,\cdots,\AutB_l))\}$.
        \textbf{[pop all activities in the top task]}
%
    \item If $(\aname'_1 \cdots \aname'_l, (\AutB_1,\cdots,\AutB_l)) \in \AutReach$, $\AutB_1 = \AutB_{A\rightsquigarrow B}$ for some $A\in\act_{\STK}\cup\act_{\SIT}$ and $B \in \Gamma_A$, and $B'  \in \Gamma_A$ such that $\Lang(\AutB_{A\rightsquigarrow B'}) \neq \emptyset$, then let 
    $\AutReach := \AutReach \cup \{(\aname'_1 \cdots \aname'_l, (\AutB_{A\rightsquigarrow B'}, \AutB_2,\cdots,\AutB_l))\}$. 
    % then adds the tuple $(\theta, (\AutB_1^{\post^*},\AutB_2,\cdots,\AutB_k))$ to $\AutReach$.
%    such that $\AutB_1 = \AutB_A^B$ for some $A\in\act_{\STK},B\in\act$, then adds the tuple $(\theta, (\AutB_A^{B'},\AutB_2,\cdots,\AutB_k))$ to $\AutReach$ for each $B'\in\act$ with $\Lang(\AutB_A^{B'})\neq\emptyset$.
        \textbf{[simulate the behaviors of the top task]}
\end{enumerate}
\end{minipage}
}

\medskip

The aforementioned procedure terminates since $\Theta_\Mm$ is finite and the set of {\NFA}s $\Aut_{A\rightsquigarrow B}$ occurring in $\AutReach$ is finite.
Let $\AutReach_f$ denote the value of $\AutReach$ when the aforementioned procedure terminates. 

Since Lemma~\ref{lem:amass-recog} can be proved similarly to Lemma~\ref{lem:iff-recog}, its proof is omitted. 

\subsection{The case $\lmd(A_0) \neq \STK$ and $\lmd(A_0) \neq \SIT$}\label{sec:amass-nostk}

As mentioned before, in this case, we focus on the evolvement of the main task, construct a {\WOTrPDS} $\Pp_{\Mm}$ for it, and abstract the contents of the other tasks into the control states of $\Pp_{\Mm}$. 

Let $A'_0$ be the unique activity such that $\lmd(A'_0) = \singletask$ and $\aft(A'_0) = \aft(A_0)$.  

From a configuration where the main task (i.e. the $A_0$-task) is the top task, we may move a non-main task to the top, then keep modifying the non-main tasks, and eventually return to the main task again (that is, the main task becomes the top task again). Let us call this task-switching process as $A_0;\mhcancel{A_0};A_0$ \emph{switchings}. If we focus on the evolvement of the main task, then we need summarize the effects of the $A_0;\mhcancel{A_0};A_0$ \emph{switchings} into the transitions of $\Pp_{\Mm}$.
In the sequel, we show how this can be done. 

%Let us first formally define the concept of $A_0;\mhcancel{A_0};A_0$ \emph{switchings}. 
Formally, an $A_0;\mhcancel{A_0};A_0$ \emph{switching} denotes a path in $\xrightarrow[\Mm]{}$ where the $A_0$-task is on the top in the \emph{first} and \emph{last} configuration, and in all the \emph{intermediate} configurations, the $A_0$-task is \emph{not} the top task. 
%
%The main idea of the construction is to simulate the $A_0;\mhcancel{A_0};A_0$ switching by a "macro"-transition of $\Pp_{\Mm}$. 
Note that the $A_0$-task regains the top task in the last configuration either by starting the activity $A_0'$ or by emptying the tasks above the $A_0$-task. Suppose that, for an $A_0;\mhcancel{A_0};A_0$ switching, $\alpha$ (resp. $\beta$) is the abstraction of the non-$A_0$-tasks in the first (resp. last) configuration. 
Then this $A_0;\mhcancel{A_0};A_0$ switching will be simulated by a "macro"-transition of $\Pp_{\Mm}$, where the control state will be updated from $\alpha$ to $\beta$, and the stack content of $\Pp_{\Mm}$ is updated accordingly. 
Specifically, the stack content of $\Pp_{\Mm}$ is updated as follows. 
\begin{itemize}
    \item If in the $A_0; \mhcancel{A_0}; A_0$ switching, the $A_0$-task becomes the top task again by starting the activity $A_0'$, say with the transition $A\xrightarrow{\startactivity(\phi)}A_0'$, (in this case, the switching is called an \emph{active} switching), then
    \begin{itemize}
        \item if $\phi \models \ctkflag$, all the symbols in the stack will be popped and $A_0'$ will be pushed into the stack,
        \item otherwise, $A_0'$ will be pushed into the stack if the $A_0$-task does not contain $A_0'$, and all the symbols above $A_0'$ will be popped otherwise.
    \end{itemize}
%
    \item If in the $A_0; \mhcancel{A_0}; A_0$ switching, the $A_0$-task becomes the top task again by popping empty all the tasks on top of the $A_0$-task (in this case, the switching is called a \emph{passive} switching), then the content of the stack stays unchanged.
%        
\end{itemize}

To define the abstractions of the non-$A_0$ tasks, we can ignore the $A_0$-task and imagine that the bottom activity of every task is either from $\act_{\singletask}$ or $\act_{\singleinstance}$.  Then we represent the set of reachable configurations (where the content of the $A_0$-task is ignored) as pairs $(\aname_1 \cdots \aname_k, (\AutB_1, \cdots, \AutB_k))$, similarly to the case that $\lmd(A_0) = \singletask$. 

Therefore, we define the set of abstractions of the non-$A_0$-tasks, denoted by $\abs_{\mhcancel{A_0}}$, as the set of pairs 
\[(\aname_1 \cdots \aname_k, (\AutB_1, \cdots, \AutB_k))\]
such that 
\begin{itemize}
\item $\aname_1 \cdots \aname_k$ is a sequence of mutually distinct affinities from $\aft((\act_{\singletask} \cup \act_{\singleinstance}) \setminus \{A'_0\})$, and 
\item for each $i \in [k]$, $\AutB_i = \AutB_{A_i \rightsquigarrow B_i}$ is a $\Pp_{A_i}$-{\WOTrNFA} such that $A_i \in \act_\singletask \cup \act_\singleinstance$, $\aft(A_i) = \aname_i$, and $B_i \in \act_\standard \cup \act_\singletop \cup \{A_i\}$, 
\end{itemize}
where $\Pp_{A_i} = (P_{A_i}, \Gamma_{A_i}, \TranSet_{A_i}, \Delta_{A_i})$ is the {\WOTrPDS} as defined in Section~\ref{sec:amass-stk}.

Let $A$ be the top activity of the $A_0$-task and $\alpha \in \abs_{\mhcancel{A_0}}$ be the abstraction of the current contents of the non-$A_0$ tasks. For constructing $\Pp_{\Mm}$, we would like to know which abstractions $\beta$ of the non-$A_0$ tasks can be reached after an $A_0;\mhcancel{A_0};A_0$ switching. Moreover, if the switching is active, namely, through a transition $B \xrightarrow{\startactivity(\phi')} A'_0$, then $\phi'$ determines how the content of the $A_0$-task evolves. Therefore, we shall compute for a given $A \in \act_\standard \cup \act_\singletop \cup \{A'_0\}$ and $\alpha \in \abs_{\mhcancel{A_0}}$, a set $\reach(A, \alpha)$ that comprises the following pairs, 
\begin{itemize}
\item the pairs $(\beta, \phi')$ such that $\beta$ is reached from $\alpha$ by an active $A_0;\mhcancel{A_0};A_0$ switching, where in the first configuration, $A$ is the top activity of the $A_0$-task and $\alpha$ is the abstraction of the non-$A_0$ tasks, and in the last configuration, $\beta$ is the abstraction of the non-$A_0$ tasks, moreover, a transition $B \xrightarrow{\startactivity(\phi')} A'_0$ is used to return to the $A_0$-task for some $B$,  
%
\item the pairs $(\beta, \bot)$ such that $\beta$ is reached from $\alpha$ by a passive $A_0;\mhcancel{A_0};A_0$ switching, where in the first configuration, $A$ is the top activity of the $A_0$-task and $\alpha$ is the abstraction of the non-$A_0$ tasks, and in the last configuration, $\beta$ is the abstraction of the non-$A_0$ tasks. 
\end{itemize}

In the sequel, we first assume that $\reach(A, \alpha)$ can be computed for $A \in \act_\standard \cup \act_\singletop \cup \{A'_0\}$ and $\alpha \in \abs_{\mhcancel{A_0}}$ and construct $\Pp_\Mm$. Then we show how to compute $\reach(A, \alpha)$. 

\paragraph*{Construction of $\Pp_\Mm$} 
We first define a {\WOTrPDS} $\Pp'_{A_0}$ that simulate the transitions of $\Mm$ that modifies only the content of the $A_0$-task. Then we add to $\Pp'_{A_0}$ the ``macro'' transitions that simulate the $A_0;\mhcancel{A_0};A_0$ switchings, to construct $\Pp_\Mm$.  

Because the bottom activity of the $A_0$-task is $A_0$ such that $\lmd(A_0) \neq \STK$ and $\lmd(A_0) \neq \SIT$, the construction of $\Pp'_{A_0}$ is slightly more involved than that of $\Pp_A$ for $A \in \act_\singletask$ in Section~\ref{sec:amass-stk}. In particular, we use two states $p_0, p_1$ to distinguish between whether $A'_0$ is in the stack or not. Moreover, in order to simulate the behaviors of the transitions $B \xrightarrow{\startactivity(\phi)} A'_0$ with $\phi \models \CTK$, where the stack is emptied before $A'_0$ is pushed, we introduce an additional symbol $\triangleleft$ to act as the bottom symbol of the stack and an additional state $p_{\sf ctk}$ for clearing the stack. 

\zhilin{stopped here}

Formally, the {\WOTrPDS} $\Pp'_{A_0}$ is defined as $(P_{A_0}, \Gamma_{A_0}, \TranSet_{A_0}, \Delta_{A_0})$, where 
\begin{itemize}
\item $P_{A_0} = \{p_0, p_1\}\cup\{ p_{B,0}, p_{B,1} \mid B \in  \act_\standard \cup \act_\singletop\} \cup \{p_{A'_0,1}, p_{\sf ctk}\}$,
\item $\Gamma_{A} = \act_\standard \cup \act_\singletop \cup \{A, \dag\}$, 
\item $\TranSet_A = \{\tau_{\id} \}\cup \{\tau_{B, \dag} \mid B \in \act_\standard \cup \act_\singletop \} \cup \{\tau_{B} \mid B \in \act_\standard \cup \act_\singletop\}  \cup \{\tau_{\not B} \mid B \in \act_\standard \cup \act_\singletop\}$, 
%where $\tau_B$ (resp. $\tau_{\not B}$) is the transduction that checks that $B$ occurs (resp. does not occur) in the input string but keeps the input string unchanged, and 
\item $\Delta_{A}$ is defined as follows:
        \begin{itemize}
            \item for each $B \in \Gamma_{A} \setminus \{\dag\}$, $(p_0, B, \varepsilon, \tau_{\id}, p_0) \in \Delta_{A}$, (Recall that $\back$ can be applied anytime in $\Mm$.)
	    %
	    \item moreover, we consider the transitions $B \xrightarrow{\startactivity(\phi)} C$ of $\Mm$ that keep the $A$-task as the top task, to construct $\Delta_A$, 
	    %therefore, we distinguish the following two cases: either $B \in \act_\standard \cup \act_\singletop \cup \{A\}$ and $C \in \act_\standard \cup \act_\singletop$, or $B \in \act_\standard \cup \act_\singletop$, $\phi \models \ntkflag$, and $C = A$, 
	    %
	    %	    	
		%	\item for each transition $B \xrightarrow{\startactivity(\phi)} C$ such that if $B \neq A$ and $\phi \models \ntkflag$, then $C = A$, 
			\begin{itemize}
				\item if $B \in \act_\standard \cup \act_\singletop \cup \{A\}$, $C \in \act_\standard \cup \act_\singletop$, and $\phi \models \neg \ntkflag$, then 
				%
				\begin{itemize}
				\item if $\phi \models \ctpflag$ and $B \neq C$, we have 
				\begin{itemize}
					\item $(p_0, C, CB, \tau_{\not C}, p_0) \in \Delta_{A}$, 
					\item $(p_0, B, \varepsilon, \tau_{C}, p_C) \in \Delta_{A}$, $(p_C, C, C, \tau_{\id}, p_0)  \in \Delta_{A}$, and for each $\gamma \in \Gamma_A \setminus \{C\}$, $(p_C, \gamma, \varepsilon, \tau_{\id}, p_C) \in \Delta_{A}$, 
				\end{itemize}
%
				\item if $\phi \models \rtfflag \wedge \neg\ctpflag$ and $B\neq C$,  
                we have $(p_0, B, CB, \tau_{\not C}, p_0) \in \Delta_{A}$ 
                and $(p_0, B, CB, \tau_{C, \dag}, p_0) \in \Delta_{A}$,
%
				\item if either $\phi \models \neg\ctpflag \wedge \neg \rtfflag \wedge \stpflag$ or $\phi \models \neg\ctpflag \wedge \neg \rtfflag$ and $\lmd(C) = \singletop$, moreover, $B \neq C$, we have $(p_0, C, CB, \tau_{\id}, p_0) \in \Delta_{A}$, 
				%
				\item if $\phi \models \neg\ctpflag \wedge \neg \rtfflag \wedge \neg \stpflag$ and $\lmd(C) = \standard$, then $(p_0, C, CB, \tau_{\id}, p_0) \in \Delta_{A}$,
				\end{itemize}
				
				\item if $B \in \act_\standard \cup \act_\singletop$ and $C = A$,  then we have $(p_0, B, \varepsilon, \tau_{\id}, p_A) \in \Delta_{A}$, $(p_A, A, A, \tau_{\id}, p_0)  \in \Delta_{A}$, and for each $\gamma \in \Gamma_A \setminus \{A\}$, $(p_A, \gamma, \varepsilon, \tau_{\id}, p_A) \in \Delta_{A}$. 
				%
            %
            \end{itemize}
        \end{itemize}
\end{itemize}




Our idea is to construct a finite abstraction for the non-$A_0$-tasks and incorporating it into the control states of the {\WOTrPDS} of $A_0$-task, then it could recognize different contents of $A_0$-task according to the contents of non-$A_0$-tasks.
Then we compute the configurations which $A_0$-task is the top task by computing the $\post^*$ of the {\WOTrPDS}, finally compute all configurations reached from the initial configuration.

% Intuitively, we assume that the current content of $A_0$-task is $A_0'CBA_0$, then when we start $B$ from $A_0'$ with the intent flag $\rtfflag$, then the content is $BA_0'C\dag A_0$. Moreover, we have $A_0'CBA_0\in\Lang((\Aut_{A_0 \stackrel{C}\rightsquigarrow A_0'}))$ and $BA_0'C\dag A_0 \in \Lang((\Aut_{A_0 \stackrel{C}\rightsquigarrow A_0'}))$, hence the proposition does not hold.

% Recall that we construct a {\PDS} $\Pp'_{A_0}$ to simulate the $A_0$-task and compute $\AutReach$ to solve the configuration reachability problem of $\STK$-dominating $\LMAMASS$ when $\lmd(A_0)\neq\STK$. 
% and in the procedure to compute $\AutReach$, we need to modify the $\Pp'_{A_0}$-{\NFA} $\Aut$ via $\STK(\Aut)$ and $\topact_{A}(\Aut)$. 
% To solve the configuration reachability problem of $\STK$-dominating $\AMASS$ , we also could construct such a {\WOTrPDS} $\Qq'_{A_0}$ to simulate the $A_0$-task, however, the main technical difficulty is that 
% the order of the $A_0$-task and the non-$A_0$-tasks may be switched for arbitrarily many times, hence we need to modify the {\WOTrNFA} for $A_0$-task arbitrarily many times, which leading to that there may be infinite {\WOTrNFA}s for $A_0$-task.

% \paragraph{Intuition of construction} 
Our main idea is to construct a {\WOTrPDS} $\Qq_{\abs}$ to simulate the $A_0$-task, where the control states in $\Qq_{\abs}$ include the abstraction of the non-$A_0$-tasks.
% so we can reduce the configuration reachability problem of $\Mm$ into that of a {\WOTrPDS} $\Qq_{\abs}$.
% Our idea is 1) to compute $\AutReach_{A_0}$ to represent the configurations, whose the top task is $A_0$-task, reached from the initial configuration first, 2) to compute $\AutReach_{\mathcircled{A_0}}$ from $\AutReach_{A_0}$ to represent the configurations whose the top task is \emph{not} $A_0$-task and $A_0$-task is in these configurations, 3) to compute $\AutReach_{\mhcancel{A_0}}$ to represent the configurations which $A_0$-task is \emph{not} in these configurations.
% the configurations whose the top task is $A_0$-task first, and then we compute the rest configurations (whose the top task is \emph{not} $A_0$-task).
% The crux of computing $\AutReach_{A_0}$ is to construct a \emph{finite abstraction} for the non-$A_0$-tasks and incorporate it into the control states, so we can reduce the configuration reachability of $\Mm$ into that of a {\WOTrPDS} $\Qq_{\abs}$. 
Observe that a run of $\Mm$ can be seen as a sequence of task switching. In particular, an $A_0;\mhcancel{A_0};A_0$ \emph{switching} denotes a path in $\xrightarrow[\Mm]{}$ where the $A_0$-task is on the top in the \emph{first} and \emph{last} configuration, and in all the \emph{intermediate} configurations, the $A_0$-task is \emph{not} the top task. The main idea of the construction is to simulate the $A_0;\mhcancel{A_0};A_0$ switching by a "macro"-transition of $\Qq_{\abs}$. Note that the $A_0$-task regains the top task in the last configuration either by starting the activity $A_0'$ or by emptying the tasks above $A_0$-task. Suppose that, for an $A_0;\mhcancel{A_0};A_0$ switching, in the first (resp. last) configuration and $\alpha$ (resp. $\beta$) is the finite abstraction of the non-$A_0$-tasks. Then for the "macro"-transition of $\Qq_{\abs}$, the control state will be updated from $\alpha$ to $\beta$, and the stack content of $\Qq_{\abs}$ is updated accordingly:

\begin{itemize}
    \item If in the $A_0; \mhcancel{A_0}; A_0$ switching, the $A_0$-task becomes the top task again by starting the activity $A_0'$, say $A\xrightarrow{\startactivity(\phi)}A_0'$, (in this case, the switching is called an \emph{active} switching), then
    \begin{itemize}
        \item if $\phi \models \ctkflag$, all the symbols will be poped and $A_0'$ will be pushed into the stack,
        \item otherwise, $A_0'$ will be pushed into the stack of  $\Qq_{\abs}$ if the stack does not contain $A_0'$, and all the symbols above $A_0'$ will be popped otherwise,
    \end{itemize}
%
    \item If in the $A_0; \mhcancel{A_0}; A_0$ switching, the $A_0$-task becomes the top task again by popping empty all the tasks on top of the $A_0$-task (in this case, the switching is called a \emph{passive} switching), then the stack of $\Qq_{\abs}$ stays unchanged.
        
\end{itemize}

Our goal is to define a finite abstraction for the non-$A_0$-tasks of $\Mm$, under the assumption that the $A_0$-task is nonempty in the back stack. 
Roughly speaking, for a configuration $((w,\aft(A_0)),(w_1,\aname_1),\cdots,(w_k,\aname_k))$ which reachable from the initial configuration, where $w$ represents the content of the $A_0$-task, and $w_1,\cdots,w_k$ represent the contents of the non-$A_0$-tasks, the abstraction of $(w_1,\aname_1),\cdots,(w_k,\aname_k)$ are defined as the set of $(w_1',\aname_1),\cdots,(w_k',\aname_k)$ satisfying the following constraint :
\begin{center}
$((w,\aft(A_0)),(w_1',\aname_1),\cdots,(w_k',\aname_k))$ could be reachable from the initial configuration.
\end{center}
More precisely, the finite abstraction for the non-$A_0$-tasks $(w_1,\aname_1),\cdots,(w_k,\aname_k)$ can be defined as $(\theta,(\AutB_1,\cdots,\AutB_k))$ where $\theta = \aname_1\cdots\aname_k$ and for each $i\in[k]$, $\AutB_i = \AutB_{A_i\rightsquigarrow B_i}$ is $\Qq_{A_i}$-{\WOTrNFA} such that $w_i = B_iw_i''A_i$ for some $B_i\in\Gamma_{A_i}, w_i''\in\Gamma_{A_i}^*, A_i\in\act_{\STK}\cup\act_{\SIT}$.

Let $\abs_{\mhcancel{A_0,A_0'}}$ denote the set of the abstractions of the pairs from $$(\aname_1\cdots\aname_k,(\AutB_1,\cdots,\AutB_k)),$$ where $k<|\aft(\act)|$ and for each $i\in[k]$, $\aname_i\in\aft(\act\setminus\{A_0'\})$ and $\AutB_i = \AutB_{A\rightsquigarrow B}$ is a $\Qq_{A}$-{\WOTrNFA} such that $A\in\act_{\STK}\cup\act_{\SIT}\setminus\{A_0'\}$ and $B\in\Gamma_A$. Specifically, we let $\bot\in\abs_{\mhcancel{A_0,A_0'}}$ to denote the empty abstraction.
% of non-$A_0$-tasks, where 
% $$\abs_{\mhcancel{A_0,A_0'}} = \bigcup\limits_{k<|\aft(\act)|}\aft(\act\setminus\{A_0'\})^k\times\AutB_{\act_{\STK}\cup\act_{\SIT}\setminus\{A_0'\}\rightsquigarrow\act}^k$$
% is the finite set of pairs $(\aname_1\cdots\aname_k,(\AutB_1,\cdots,\AutB_k))$ where for each $i\in[k]$
% each of $\AutB_i$'s are of the form $\AutB_{A\rightsquigarrow B}$ for $A\in\act_{\STK}\cup\act_{\SIT}$ and $B\in\Gamma_{A}$ 

To facilitate the construction of the {\WOTrPDS} $\Qq_{\abs}$, we also need to record how the abstraction ``evolves". For each $(A, \alpha) \in (\act_{\standard}\cup\act_{\singletop}\cup\{A_0'\}) \times \abs_{\mhcancel{A_0,A_0'}}$, 
we compute $\reach(A, \alpha)$ consisting the union of 
\begin{itemize}
    \item the set of pairs $(\beta,\phi)$ such that $\beta$ is reached from $\alpha$ by an active $A_0; \mhcancel{A_0}; A_0$ switching, in which $A$ is the top activity of the $A_0$-task in the first configuration, 
    and $\alpha$ (resp. $\beta$) is the abstraction of the non-$A_0$-tasks in the first (resp. last) configuration.
    \item the set of pairs $(\beta,\bot)$ such that $\beta$ is reached from $\alpha$ by an passive $A_0; \mhcancel{A_0}; A_0$ switching, in which $A$ is the top activity of the $A_0$-task in the first configuration,
    and $\alpha$ (resp. $\beta$) is the abstraction of the non-$A_0$-tasks in the first (resp. last) configuration.
\end{itemize}

To compute $\reach(A,\alpha)$, we need to compute all possible abstractions $\beta'$ that could be reachable from $(\aft(B),(\AutB_{B}))$ for each $A\xrightarrow{\startactivity(\phi)}B\in\Delta$ such that $B\in\act_{\STK}\cup\act_{\SIT}\setminus\{A_0'\}$. Then $\beta$ could be divided into two parts $\beta'$ and $\alpha'$, where $\alpha'$ is obtained from $\alpha$ by removing all $\aname_i$ and $\AutB_i$ such that $C$-task is launched from the procedure of reaching $\beta'$ from $(\aft(B),(\AutB_{B}))$ and $\aft(C) = \aname_i$. Therefore we need to record which tasks launched in the computation of $\beta'$.

For each $B\in\act_{\STK}\cup\act_{\SIT}\setminus\{A_0'\}$, we let $\AutReach_{B}$ to denote the set of pairs $(\Lambda, \beta')$ where $\Lambda \subseteq \act_{\STK}\cup\act_{\SIT}\setminus\{A_0'\}$ and $\beta' \in \abs_{\mhcancel{A_0, A_0'}}$. Intuitively, for each $(\Lambda, \beta') \in \AutReach_{B}$, $\beta'$ could be reachable from $(\aft(B),(\AutB_{B}))$ and $\Lambda$ records the activities which launching a new task the this procedure.

Initially, we let $\AutReach_{B} = \{(\{B\}, (\aft(B), (\AutB_B)))\}$. Then it adds pairs to $\AutReach_{B}$ according the following saturation rules, until no more tuples can be added.

\smallskip
\fbox
{
\begin{minipage}{0.9\textwidth}
\begin{enumerate}
    \item If $A \xrightarrow{\startactivity(\phi)}A' \in\Delta$, $A'\neq A_0'$, $\lmd(A')=\STK$ or $\singleinstance$, $(\Lambda,(\theta, (\AutB_1,\cdots,\AutB_k))) \in \AutReach_{B}$ such that $\Lang(\AutB_1) \neq \emptyset$ and $\AutB_1 = \AutB_{C\rightsquigarrow A}$ for some $C \in \act_\singletask\cup\act_\singleinstance\setminus\{A_0'\}$, moreover, $\namefun_{A'}(\theta) = \bot$,
    then let $\AutReach_{B}: = \AutReach_{B} \cup \{(\Lambda\cup\{A'\},(\aft(A')\theta, (\AutB_{A'},\AutB_1,\cdots,\AutB_k)))\}$.
    % 
    \item If $A \xrightarrow{\startactivity(\phi)}A' \in\Delta$, $A'\neq A_0'$, $\lmd(A')=\STK$ or $\singleinstance$, $(\Lambda,(\theta, (\AutB_1,\cdots,\AutB_k))) \in \AutReach_{B}$ such that $\Lang(\AutB_1) \neq \emptyset$ and $\AutB_1 = \AutB_{C\rightsquigarrow A}$ for some $B \in \act_\singletask\cup\act_\singleinstance\setminus\{A_0'\}$, moreover, $\namefun_{A'}(\theta) = i$ for some $i \in [k]$ with $i > 1$, 
        then let $\AutReach_{B}:= \AutReach_{B} \cup \{(\Lambda\cup\{A'\},(\theta', (\AutB_{A'}, \AutB_1, \cdots,\AutB_{i-1},\AutB_{i+1},\cdots,\AutB_{k})))\}$, where $\theta' = \aname_i\aname_1\dots\aname_{i-1}\aname_{i+1}\dots\aname_k$. 
        % and $\AutB_1'$ is obtained from $\AutB_1$ by removing all non-$A$ transitions out of $p_0$, then removing all transitions cannot be reached from $p_0$.
        %
    \item If $(\Lambda,(\aname_1 \cdots \aname_k, (\AutB_1,\cdots,\AutB_k))) \in \AutReach_{B}$, then let $\AutReach_{B} := \AutReach_{B} \cup \{(\Lambda,(\aname_2\dots\aname_k, (\AutB_2,\cdots,\AutB_k)))\}$ if $k > 1$, let $\AutReach_{B} := \AutReach_{B} \cup \{(\Lambda,\bot)\}$ otherwise.
%
    \item If $(\Lambda,(\theta, (\AutB_1,\cdots,\AutB_k))) \in \AutReach_{B}$, $\AutB_1 = \AutB_{A\rightsquigarrow C}$ for some $A\in\act_{\STK}\cup\act_{\SIT}\setminus\{A_0'\}$ and $C \in \Gamma_A$, and $C'  \in \Gamma_A$ such that $\Lang(\AutB_{A\rightsquigarrow C'}) \neq \emptyset$, then let 
    $\AutReach_{B} := \AutReach_{B} \cup \{(\Lambda,(\theta, (\AutB_{A\rightsquigarrow C'}, \AutB_2,\cdots,\AutB_k)))\}$. 

    % for each $B'\in\act$ with $\Lang(\AutB_A^{B'})\neq\emptyset$.
\end{enumerate}
\end{minipage}
}

To compute how to obtain the new abstraction from the abstraction $\alpha$ when a $C$-task is launched, we need an additional notation $\rmv(C,\alpha)$,
%  for an abstraction $\alpha$ and $B\in\act_{\STK}\cup\act_\SIT\setminus\{A_0'\}$, which intuitively specifies how to obtain the new abstraction from the abstraction $\alpha$ when an activity $B$ is started. 
More precisely, if $\alpha = \bot$ then $\rmv(C,\alpha) = \alpha$, otherwise we let $\alpha = (\theta, (\AutB_1,\cdots, \AutB_k))$ with $\theta = \aname_1\dots\aname_k$, and define $\rmv(C,\alpha)$ as follows:
\begin{itemize}
    \item if $\namefun_C(\theta) = \bot$, then $\rmv(C,\alpha) = \alpha$,
    \item if $\namefun_C(\theta) = 1$, then $\rmv(C,\alpha) = (\aname_2\dots\aname_k,(\AutB_2,\cdots,\AutB_k))$ if $k>1$, $\rmv(C,\alpha) = \bot$ otherwise,
    \item if $\namefun_C(\theta) = i > 1$ , then $\rmv(C,\alpha) = (\theta',(\AutB_1,\cdots,\AutB_{i-1},\AutB_{i+1},\cdots,\AutB_{k}))$, where $\theta' = \aname_1\dots\aname_{i-1}\aname_{i+1}\dots\aname_k$.
\end{itemize}
For $\Lambda = \{C_1,\cdots,C_r\}$, we define $\rmv(\Lambda,\alpha) = \rmv(C_1,(\cdots,\rmv(C_r,\alpha)))$.

Now we are ready to define $\reach(A,\alpha)$. For each $(A,\alpha) \in (\act_{\STD}\cup\act_{\STP}\cup\{A_0'\})\times\abs_{\mhcancel{A_0,A_0'}}$, $\reach(A,\alpha)$ comprises
 \begin{itemize}
     \item the pairs $(\beta, \phi')$ such that there exist $B\in\act_{\STK}\cup\act_\SIT\setminus\{A_0'\}$ and $\Lambda'\subseteq\act_{\STK}\cup\act_\SIT\setminus\{A_0'\}$ satisfying that $A\xrightarrow{\startactivity(\phi)}B\in\Delta$, and $(\Lambda',(\theta',(\AutB_1',\cdots,\AutB_l')))\in\AutReach_{B}$, where
    %  $(\{B\},(\aft(B),(\AutB_B)))\xRightarrow{\AutReach_{\mhcancel{A_0,A_0'}}}(\Lambda',(\theta',(\AutB_1',\cdots,\AutB_l')))$ where 
    %  $\alpha' = (\aft(B),(\AutB_B),\{B\})$, $\beta' = (\theta',(\AutB_1',\cdots,\AutB_l'),\Lambda')$ and 
     we let $\AutB_1' = \AutB_{B'}^{A'}$ for some $A'\in\act$ and $B'\in\act_{\STK}\cup\act_\SIT\setminus\{A_0'\}$, $A'\xrightarrow{\startactivity(\phi')}A_0'\in\Delta$, and we let $\rmv(\Lambda',\alpha) = (\theta'',(\AutB_1'',\cdots,\AutB_m''))$ (resp. $\rmv(\Lambda',\alpha) = \bot$), $\beta = (\theta'\theta'',(\AutB_1',\cdots,\AutB_l',\AutB_1'',\cdots,\AutB_m''))$ (resp. $\beta = (\theta',(\AutB_1',\cdots,\AutB_l'))$),
%
    \item the pairs $(\rmv(\Lambda',\alpha), \bot)$ such that there exist $B\in\act_{\STK}\cup\act_\SIT\setminus\{A_0'\}$ and $\Lambda'\subseteq\act_{\STK}\cup\act_\SIT\setminus\{A_0'\}$ satisfying that $A\xrightarrow{\startactivity(\phi)}B\in\Delta$, and $(\Lambda',\bot)\in\AutReach_{B}$.
    % $(\{B\},(\aft(B),(\AutB_B)))\xRightarrow{\AutReach_{\mhcancel{A_0,A_0'}}}(\Lambda',\bot)$.
     
 \end{itemize}

\paragraph{Construction of $\Qq_{\abs}$} 
We first construct a {\WOTrPDS} $\Qq'_{A_0} = (P_{A_0},\Gamma_{A_0},\TranSet_{A_0},\Delta_{A_0})$ to simulate the $A_0$-task of $\Mm$ while the non-$A_0$-tasks are \emph{not} started, where
\begin{itemize}
    \item $P_{A_0} = \{p_0,p_1, p_{\pop}, p_{\ctkflag}\}\cup\{p_{A,b}\mid A\in\act, b\in\{0,1\}\}$,
    \item $\Gamma_{A_0} = \act_\STD \cup \act_\STP \cup \{\dag,\triangleleft\}$, 
    \item $\TranSet_{A_0} = \{\tau_{\id} \}\cup \{\tau_{A, \dag} \mid A \in \act\} \cup \{\tau_{A} \mid A \in \act\}  \cup \{\tau_{\not A} \mid A \in \act\}$,
    %  where $\tau_A$ is the transduction that checks that $A$ occurs in the input string but keeps the input string unchanged, and 
    \item $\Delta_{A_0}$ is defined as follows:
            \begin{itemize}
                \item For each $A \in \Gamma_{A_0}\setminus\{\dag,\triangleleft\}$, 
                \begin{itemize}
                    \item if $A = A_0'$, then $(p_1,A_0',\varepsilon,\tau_{\id},p_0)\in\Delta_{A_0}$,
                    \item otherwise, for each $b\in\{0,1\}$, then $(p_b,A,\varepsilon,\tau_{\id},p_b)\in\Delta_{A_0}$.
                \end{itemize}
                \item For each transition rule $A\xrightarrow{\startactivity(\phi)}A'\in\Delta$ such that $\lmd(A)\neq\SIT$ and $\lmd(A')\neq\SIT$,
                % and $\lmd(B) \neq \STK$
                \begin{itemize}
                    \item if either $\lmd(A') = \STD$ and $\phi = \bot$ or $\lmd(A') = \STD$ and $\phi\models\stpflag\wedge\neg\rtfflag\wedge\neg\ctpflag$ and $A\neq A'$ or $\lmd(A') = \STP$ and $\phi\models\neg\rtfflag\wedge\neg\ctpflag$ and $A\neq A'$, 
                    % \item if $\phi\models\stpflag$ and $A\neq B$, or $\phi=\bot$, 
                    for each $b\in\{0,1\}$, then $(p_b, A, A'A, \tau_{\id}, p_b) \in \Delta_{A_0}$, 
                    \item if $\lmd(A') = \STD$ or $\STP$, and $\phi\models \ctpflag$ such that $A\neq A'$ and $A\neq A_0'$,
                    % \item if $\phi\models\ctpflag$, such that $A\neq B$ and $A\neq A_0'$, 
                    \begin{itemize}
                        \item for each $b\in\{0,1\}$, we have $(p_b, A, A'A, \tau_{\not A'}, p_b) \in \Delta_{A_0}$, 
                        \item for each $b\in\{0,1\}$, we have $(p_b, A, \varepsilon, \tau_{A'}, p_{A',b}) \in \Delta_{A_0}$, and for each $B \in \Gamma_{A_0}\setminus\{A',A_0',\triangleleft\}$, $(p_{A',b}, B, \varepsilon, \tau_{\id}, p_{A',b}) \in \Delta_{A_0}$, moreover, $(p_{A',1},A_0',\varepsilon,\tau_{\id},p_{A',0})\in\Delta_{A_0}$, $(p_{A',b}, A', A', \tau_{id}, p_b)  \in \Delta_{A_0}$, 
                    \end{itemize}
                    \item if $\lmd(A') = \STD$ or $\STP$, and $\phi\models \ctpflag$ such that $A\neq A'$ and $A = A_0'$,
                    \begin{itemize}
                        \item $(p_1, A_0', A'A_0', \tau_{\not A'}, p_1) \in \Delta_{A_0}$, 
                        \item $(p_1, A_0', \varepsilon, \tau_{A'}, p_{A',0}) \in \Delta_{A_0}$, and for each $B \in \Gamma_{A_0}\setminus\{A',A_0',\triangleleft\}$, $(p_{A',0}, B, \varepsilon, \tau_{\id}, p_{A',0}) \in \Delta_{A_0}$, moreover, $(p_{A',0}, A', A', \tau_{id}, p_0)  \in \Delta_{A_0}$, 
                    \end{itemize}
                    \item if $\lmd(A') = \STD$ or $\STP$, and $\phi\models\rtfflag\wedge\neg\ctpflag$ such that $A\neq A'$,
                    then for each $b\in\{0,1\}$, $(p_b, A, A'A, \tau_{\not A'}, p_b) \in \Delta_{A_0}$ 
                    and $(p_b, A, A'A, \tau_{A', \dag}, p_b) \in \Delta_{A_0}$,
                    \item if $\lmd(A') = \STK$, $A\neq A_0'$, $A' = A_0'$ and $\phi\models\ctkflag$, then
                    for each $b\in\{0,1\}$, $(p_b, A, \epsilon, \tau_{\id}, p_{\ctkflag})\in\Delta_{A_0}$, 
                    and for each $B\in\Gamma_{A_0}\setminus\{\triangleleft\}$ then $(p_{\ctkflag},B,\epsilon,\tau_{\id}, p_{\ctkflag})\in\Delta_{A_0}$, moreover, $(p_{\ctkflag},\triangleleft,A_0'\triangleleft,\tau_{\id},p_1)\in\Delta_{A_0}$,
                    \item if $\lmd(A') = \STK$, $A\neq A_0'$, $A' = A_0'$ and $\phi\models\neg\ctkflag$, then
                    \begin{itemize}
                        \item $(p_0,A,A_0'A,\tau_{\id},p_1)\in\Delta_{A_0}$,
                        \item $(p_1, A,\epsilon,\tau_{\id},p_{\pop})\in\Delta_{A_0}$, and for each $B\in\Gamma_{A_0}\setminus\{A_0',\triangleleft\}$, then $(p_{\pop},B,\epsilon,\tau_{\id},p_{\pop})\in\Delta_{A_0}$, moreover, $(p_{\pop},A_0',A_0',\tau_{\id},p_1)\in\Delta_{A_0}$, 
                    \end{itemize}
                \end{itemize}
                %
            \end{itemize}
    \end{itemize}
% Here $P_{A_0} = \{p_0,p_1,p_{\pop},p_{\ctkflag}\}\cup\{p_{A,b}\mid A\in \act, b\in\{0,1\}\}$, $\Gamma_{A_0}=\act_{\standard}\cup\{A_0'\}$, and $\Delta_{A_0}$ is defined as follows:
\hide{
\begin{itemize}
    \item for each $b\in\{0,1\}$ and $(A,\PUSH(B))\in\Delta$, we have $((p_0,b),A,BA,\tau_{\id},(p_0,b))\in\Delta_{A_0}$, \textbf{[push a standard activity]}
    \item for each $b\in\{0,1\}$ and $(A,\STP(B))\in\Delta$ such that $A\neq B$, we have $((p_0,b),A,BA,\tau_{\id},(p_0,b))\in\Delta_{A_0}$, \textbf{[push a standard activity]}
    \item for each $b\in\{0,1\}$ and $(A, \CTP(B)) \in \Delta$ such that $A \neq B$ and $A\neq A_0'$, we have
        \begin{itemize}
            \item $((p_0,b), A, BA, \tau_{\not B}, (p_0,b)) \in \Delta_{A_0}$, \textbf{[push a standard activity]}
            \item $((p_0,b), A, \varepsilon, \tau_{B}, (\langle B,\CTP\rangle,b)) \in \Delta_{A_0}$, $((\langle B, \CTP\rangle,b), B, B, \tau_{id}, (p_0,b))  \in \Delta_{A_0}$, 
        and for each $A' \in \Gamma_{A_0} \setminus \{B,A_0'\}$, we have $((\langle B, \CTP\rangle,b), A', \varepsilon, \tau_{\id}, (\langle B, \CTP\rangle,b)) \in \Delta_{A_0}$, \textbf{[pop until $B$]}
    \item $((\langle B,\CTP\rangle,1),A_0',\epsilon,(\langle B,\CTP\rangle,0))\in\Delta_{A_0}$, \textbf{[pop $A_0'$]}
        \end{itemize}
    \item for each $(A_0', \CTP(B)) \in \Delta$, we have 
        \begin{itemize}
            \item $((p_0,1), A_0', BA_0', \tau_{\not B}, (p_0,1)) \in \Delta_{A_0}$, \textbf{[push a standard activity]}
            \item $((p_0,1), A_0', \varepsilon, \tau_{B}, (\langle B,\CTP\rangle,0)) \in \Delta_{A_0}$, 
        $((\langle B, \CTP\rangle,0), B, B, \tau_{id}, (p_0,0))  \in \Delta_{A_0}$, and for each $A' \in \Gamma_{A_0} \setminus \{B,A_0'\}$, $((\langle B, \CTP\rangle,0), A', \varepsilon, \tau_{\id}, (\langle B, \CTP\rangle,0)) \in \Delta_{A_0}$, \textbf{[pop until $B$]}
        \end{itemize}
    \item for each $b\in\{0,1\}$ and $(A, \RTF(B)) \in \Delta$ such that $A \neq B$, we have 
        \begin{itemize}
            \item $((p_0,b), A, BA, \tau_{\not B}, (p_0,b)) \in \Delta_{A_0}$ \textbf{[push a standard activity]}
            \item $((p_0,b), A, BA, \tau_{B, \dag}, (p_0,b)) \in \Delta_{A_0}$ \textbf{[escalate $B$ to be the top]}
        \end{itemize}
    \item for each transition $(A,\STK(A_0'))\in\Delta$ such that $A\neq A_0'$, we have 
        \begin{itemize}
            \item $((p_0,0),A,A_2A,\tau_{\id},(p_0,1))\in\Delta_{A_0}$ \textbf{[push $A_0'$]}
            \item $((p_0,1),A,\epsilon,(p_0,1,\pop))\in\Delta_{A_0}$, $((p_0,1,\pop),A_0',A_0',\tau_{\id},(p_0,1))$, and for each $A\in\Gamma_{A_0}\setminus\{A_0'\}$, we have $((p_0,1,\pop),A,\epsilon,\tau_{\id},(p_0,1,\pop))\in\Delta_{A_0}$, \textbf{[pop until $A_0'$]}
        \end{itemize}
    \item for each $A\in\Gamma_{A_0}$, 
        \begin{itemize}
            \item if $A=A_0'$, then we have $((p_0,1),A,\epsilon,\tau_{\id},(p_0,0))$, \textbf{[pop $A_0'$]}
            \item otherwise, for each $b\in\{0,1\}$, we have $((p_0,b),A,\epsilon,\tau_{\id},(p_0,b))\in\Delta_{A_0}$. \textbf{[pop a standard activity]}
        \end{itemize}
\end{itemize}
}
We then define the {\WOTrPDS} $\Qq_{\abs} = (P_{\abs},\Gamma_{A_0},\Delta_{\abs})$, where $P_{\abs} = \abs_{\mhcancel{A_0,A_0'}}\times P_{A_0}$, and $\Delta_{\abs}$ comprises the following transitions,
\begin{itemize}
    \item for each $(p,\gamma,w,\tau,p')\in\Delta_{A_0}$ and $\alpha\in\abs_{\mhcancel{A_0,A_0'}}$, we have $((\alpha,p),\gamma,w,\tau,(\alpha,p'))\in\Delta_{\abs}$, \textbf{[behavior of the $A_0$-task]}
    \item for each $(A,\alpha)\in(\act_{\standard}\cup\{A_0'\})\times\abs_{A_0,A_0'}$ and $(\beta,\phi')\in\reach(A,\alpha)$, 
        \begin{itemize}
            \item if $\phi' \models \ctkflag$, then for each $b \in \{0,1\}$ we have $((\alpha,p_b),A,\epsilon,\tau_{\id},(\beta,p_{\ctkflag}))\in\Delta_{\abs}$,
            \item otherwise,
            \begin{itemize}
                \item if $A\neq A_0'$, then we have
                    $((\alpha,p_0),A,A_0'A,\tau_{\id},(\beta,p_1))\in\Delta_{\abs}$ and $((\alpha,p_1),A,\epsilon,\tau_{\id},(\beta,p_{\pop}))\in\Delta_{\abs}$,
                \item if $A=A_0'$, then we have $((\alpha,p_1),A_0',A_0',\tau_{\id},(\beta,p_1))\in\Delta_{\abs}$,
            \end{itemize}
        \end{itemize}
                \textbf{[swith to the non-$A_0$-tasks and swith back to the $A_0$-task later by launching $A_0'$]}
    \item for each $(A,\alpha)\in(\act_{\standard}\cup\{A_0'\})\times\abs_{A_0,A_0'}$, $(\beta,\bot)\in\reach(A,\alpha)$ and $b\in\{0,1\}$, we have \\
        $((\alpha,p_b),A,A,\tau_{\id},(\beta,p_b))\in\Delta_{\abs}$,
            \textbf{[swith to the non-$A_0$-tasks and swith back to the $A_0$-task later when the non-$A_0$-tasks above $A_0$-task become empty]}
\end{itemize}

\paragraph{Computing $\AutReach$} We are ready to present the procedure that computes effectively $\AutReach$.
% To compute $\AutReach$, our approach is 1) to compute $\AutReach_{A_0}$ to represent the configurations, whose the top task is $A_0$-task, reached from the initial configuration first, 2) to compute $\AutReach_{\mathcircled{A_0}}$ from $\AutReach_{A_0}$ to represent the configurations whose the top task is \emph{not} $A_0$-task and $A_0$-task is \emph{still} in these configurations, 3) to compute $\AutReach_{\mhcancel{A_0}}$ to represent the configurations which $A_0$-task is \emph{not} in these configurations. 

Before presenting the saturation rules, we define the $\Qq_{\abs}$-{\WOTrNFA} $\AutB_{A_0}$ and $\AutB_{\alpha\rightsquigarrow A}$ for $\alpha\in\abs_{\mhcancel{A_0,A_0'}}$ and $A\in\act$ such that $\Lang(\AutB_{A_0}) = [A_0\triangleleft]$ and $\Lang(\AutB_{\alpha\rightsquigarrow A}) = \Lang((\AutB_{A_0})^{\post^*}_{\Qq_{\abs}}((\alpha,p_0)))\cup\Lang((\AutB_{A_0})^{\post^*}_{\Qq_{\abs}}((\alpha,p_1)))\cap A\act^*$.
\begin{itemize}
    \item $\AutB_{A_0} = (P_{\abs}', \Gamma_{A_0},\delta_{A_0}, \{(\bot,p_0)\}, \{p_f\})$, where
    \begin{itemize}
        \item $P_{\abs}' = P_{\abs}\cup \{p_f',p_f\} \cup \{\langle p, A\rangle\mid p\in P_{\abs}' ,A\in\Gamma_{A_0}\} \cup \{(\alpha,A)\mid\alpha\in\abs_{\mhcancel{A_0,A_0'}}, A\in\Gamma_{A_0}\}$,
        % \item $I_{A_0} = \{(\alpha,A)\mid\alpha\in\abs_{\mhcancel{A_0,A_0'}}, A\in\Gamma_{A_0}\}$,
        \item $\delta_{A_0} = \{((\bot, p_0), A_0, \tau_{\id}, p_f'),(p_f',\triangleleft,\tau_{\id},p_f)\}$.
    \end{itemize}
    \item $\AutB_{\alpha\rightsquigarrow A}$ is obtained from $(\AutB_{A_0})^{\post^*}_{\Qq_{\abs}}$ by adding transitions $((\alpha, A), A, \tau, p)$ if $(\alpha, p_b)\xRightarrow[(\AutB_{A_0})^{\post^*}_{\Qq_{\abs}}]{A\mid\tau}p$ for some $b\in\{0, 1\}$, and setting the initial state as $\{(\alpha, A)\}$.
\end{itemize}

% a notation $\topact_{\alpha,A}(\AutB)$ for a $\Qq_{\abs}$-{\WOTrNFA} $\AutB$ and some $\alpha\in\abs_{\mhcancel{A_0,A_0'}}, A\in\act$ and we require that $(\Lang(\AutB((\alpha,p_0)))\cup\Lang(\AutB((\alpha,p_1))))\cap A\act^*\neq\emptyset$. Moreover, $\Lang(\topact_{\alpha,A}(\AutB)) = (\Lang(\AutB((\alpha,p_0)))\cup\Lang(\AutB((\alpha,p_1))))\cap A\act^*$. $\topact_{\alpha, A}(\AutB)$ is obtained from $\AutB$ by adding the transitions $((\alpha,A), A, \tau, p)$ for each $(\alpha,p_b)\xRightarrow[\AutB]{A,\tau}p$ where $b\in\{0,1\}$, and setting the initial state as $(\alpha,A)$.
% removing all non-$A$ transitions out of $p_b$, then removing all transitions cannot be reached from $p_b$ and setting the initial state as $p_b$, finally removing all transitions out of $p_0$ (resp. $p_1$) and removing all transitions cannot be reached from $p_0$ (resp.$p_1$) if $b = 1$ (resp. $b = 0$). Note that we could use $\topact_{A,1}(\Aut)$ to replace $\topact_{A}(\Aut)$ for a $\Qq_A$-{\NFA}.
% To compute $\AutReach$, we need an additional notation $\topact_{\alpha,b}(\AutB)$ for a $\Qq_{\abs}$ {\WOTrNFA} $\AutB$.

% From $\Qq_{\abs}$, we could compute the set of configurations represented by $\AutReach_{A_0}\subseteq\AutReach$ which the top task is $A_0$-task via computing $\post^*(\{((\bot, p_0), A_0\triangleleft)\})$. More precisely, we first construct a $\Qq_{\abs}$-{\WOTrNFA} 
% $$\AutB = (P_{\abs}, \act\cup\{\dag,\triangleleft\}, \{((\bot, p_0), A_0, \tau_{\id}, p_f'),(p_f',\triangleleft,\tau_{\id},p_f)\}, \{p_f,p_f'\}).$$
% Then we compute $\AutB^{\post^*}$ from the procedure in Section~\ref{sec:reach-ifamass}, 
% and let $\AutB^{\post^*} = (P_{\abs},\act,\delta,\{p_f,p_f'\})$. 

% Then we compute $\AutReach_{A_0}$ as follows: 
For each $\alpha\in\abs_{\mhcancel{A_0,A_0'}}$ and $A\in\act$ such that $\Lang(\AutB_{\alpha\rightsquigarrow A})\neq \emptyset$.
From the definition of $\Qq'_{A_0}$, $\Qq_{\abs}$, $\AutB_{A_0}$ and $\AutB_{\alpha\rightsquigarrow A}$, we know that
\begin{itemize}
    \item $\Lang(\AutB_{A_0})\subseteq\Lang(\AutB_{\bot\rightsquigarrow A_0})$,
    \item $\Lang((\AutB_{A_0})^{\post^*}_{\Qq_{\abs}}) = \bigcup\limits_{\alpha\in\abs_{\mhcancel{A_0,A_0'}}, A\in\act}\Lang(\AutB_{\alpha\rightsquigarrow A})$.
\end{itemize}

% \begin{itemize}
%     \item if $\alpha = \bot$, then $(\aft(A_0), \AutB_{\bot,A})\in\AutReach_{A_0}$,
%     \item if $\alpha = (\theta,(\AutB,\cdots,\AutB_k))$, then $(\aft(A_0)\theta, (\AutB_{\alpha,A}, \AutB_1, \cdots, \AutB_k))\in\AutReach_{A_0}$.
% \end{itemize}
% Then we compute $\AutReach_{\mathcircled{A_0}}$ by repeatedly applying a finite set of saturation rules.
Initially, we let $\AutReach$ comprises the following pairs:
For each $\alpha\in\abs_{\mhcancel{A_0,A_0'}}$ and $A\in\act$ such that $\Lang(\AutB_{\alpha\rightsquigarrow A})\neq \emptyset$,
\begin{itemize}
    \item if $\alpha = \bot$, then $(\aft(A_0), (\AutB_{\bot\rightsquigarrow A}))\in\AutReach$,
    \item if $\alpha = (\theta,(\AutB,\cdots,\AutB_k))$, then $(\aft(A_0)\theta, (\AutB_{\alpha\rightsquigarrow A}, \AutB_1, \cdots, \AutB_k))\in\AutReach$.
\end{itemize}
% = \{(\aft(A_0),(\AutB_{\bot\rightsquigarrow A}))\mid A\in\Gamma_{A_0}\setminus\{\dag,\triangleleft\}, \Lang(\AutB_{\bot\rightsquigarrow A})\neq\emptyset\}$, 
From the definition of $\Aut_{A_0}$ and $\Qq_{\abs}$, we know that $\Lang_{\mhcancel{A_0,A_0'}}((\AutB_{A_0})^{\post^*}_{\Qq_{\abs}})$ represents all contents of $A_0$-task of the configurations reachable from the initial configuration in $\Mm$, under the assumption that $A_0$-task is the top task in the configuration. Moreover, $w\in\Lang_{\mhcancel{A_0,A_0'}}((\AutB_{A_0})^{\post^*}_{\Qq_{\abs}}((\alpha,p_b)))$ for some $b\in\{0,1\}$ and $\alpha \in \abs_{\mhcancel{A_0,A_0'}}$, iff
\begin{itemize}
    \item if $\alpha = \bot$, $(\aft(A_0), w)$ could be reachable from the initial configuration.
    \item if $\alpha = (\theta, (\AutB_1, \cdots, \AutB_k))$, for each $(S_1, \cdots, S_k) \in \Lang_{\mhcancel{A_0,A_0'}}(\AutB_1) \times \cdots \times \Lang_{\mhcancel{A_0,A_0'}}(\AutB_k)$, $(\aft(A_0)\theta, (w, S_1, \cdots, S_k))$ could be reachable from the initial configuration.
\end{itemize}
Then from the initialization of $\AutReach$ and
$$\Lang((\AutB_{A_0})^{\post^*}_{\Qq_{\abs}}) = \bigcup\limits_{\alpha\in\abs_{\mhcancel{A_0,A_0'}}, A\in\act}\Lang(\AutB_{\alpha\rightsquigarrow A}),$$
we know that $\AutReach$ could recognizes all configurations reachable from the initial configuration in $\Mm$, under the assumption that $A_0$-task is the top task in the configuration.

Then it adds pairs to $\AutReach$ to recognize the configurations reachable from the initial configuration in $\Mm$, under the assumption that $A_0$-task is not the top task or $A_0$-task is empty, according to the following saturation rules, until no more pairs can be added.
% we could obtain $\AutReach_{\mathcircled{A_0}}$ by adding the tuples according the following saturation rules.

\smallskip
\fbox
{
\begin{minipage}{0.9\textwidth}
\begin{enumerate}
    \item If $A\xrightarrow{\startactivity(\phi)}A'\in\Delta$, $\lmd(A') = \STK$, 
    $(\theta, (\AutB_1,\cdots,\AutB_k)) \in \AutReach$ such that $A\act^*\cap\Lang(\AutB_1)\neq \emptyset$, moreover, $\namefun_{A'}(\theta) = \bot$, 
    then let $\AutReach:=\AutReach\cup\{(\aft(A')\theta, (\AutB_{A'},\AutB_1,\cdots,\AutB_k))\}$.
    % 
    \item If $A\xrightarrow{\startactivity(\phi)}A'\in\Delta$, $\lmd(A') = \STK$, $(\theta, (\AutB_1,\cdots,\AutB_k)) \in \AutReach$ such that $A\act^*\cap\Lang(\AutB_1)\neq \emptyset$ moreover $\namefun_{A'}(\theta) = i \neq\bot$ and $i\neq 1$ and $\AutB_i = \AutB_{B\rightsquigarrow A}$ for some $B\in\act_\STK\cup\act_\SIT$,
    then let $\AutReach:=\AutReach\cup\{(\theta', (\AutB_{A'},\AutB_1,\cdots,\AutB_{i-1},\AutB_{i+1},\cdots,\AutB_{k}))\}$, where $\theta' = \aname_i\aname_1\dots\aname_{i-1}\aname_{i+1}\dots\aname_k$.
    % 
    \item If $(\aname_1\cdots\aname_k, (\AutB_1,\cdots,\AutB_k)) \in \AutReach$ and $k>1$,
    then let $\AutReach:=\AutReach\cup\{(\aname_2\dots\aname_k, (\AutB_2,\cdots,\AutB_k))\}$.
    % 
    \item If $(\theta, (\AutB_1,\cdots,\AutB_k)) \in \AutReach$, $\AutB_1 = \AutB_{A\rightsquigarrow B}$ for some $A\in\act_{\STK}\cup\act_{\SIT}$ and $B \in \Gamma_A$, and $B'  \in \Gamma_A$ such that $\Lang(\AutB_{A\rightsquigarrow B'}) \neq \emptyset$, then let 
    $\AutReach := \AutReach \cup \{(\theta, (\AutB_{A\rightsquigarrow B'}, \AutB_2,\cdots,\AutB_k))\}$. 
\end{enumerate}
\end{minipage}
}
